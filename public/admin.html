<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>管理者画面</title>
</head>
<body>
  <h1>管理者画面</h1>
  <p>現在番号: <span id="currentNumber">0</span></p>
  <p>入場: <span id="enteredCount">0</span> / 退場: <span id="exitedCount">0</span></p>

  <button onclick="location.href='/admin/prev'">前へ</button>
  <button onclick="location.href='/admin/next'">次へ</button>
  <button onclick="location.href='/admin/enter'">入場</button>
  <button onclick="location.href='/admin/exit'">退場</button>

  <h2>呼び出し設定</h2>
  <form method="POST" action="/admin/admin">
    <label>何人先まで呼び出すか: <input type="number" name="callAhead" value="3"></label>
    <button type="submit">更新</button>
  </form>

  <h2>整理券発行</h2>
  <label>開始番号: <input type="number" id="startNum"></label>
  <label>終了番号: <input type="number" id="endNum"></label>
  <label>利用者URL: <input type="text" id="userUrl" placeholder="https://example.com/user"></label>
  <button onclick="generateTickets()">発行</button>
  <p><a id="pdfLink" href="#" target="_blank" style="display:none;">PDFをダウンロード</a></p>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    socket.on("update", (data) => {
      document.getElementById("currentNumber").textContent = data.currentNumber;
      document.getElementById("enteredCount").textContent = data.enteredCount;
      document.getElementById("exitedCount").textContent = data.exitedCount;
    });

    function generateTickets() {
      const start = parseInt(document.getElementById("startNum").value);
      const end = parseInt(document.getElementById("endNum").value);
      const url = document.getElementById("userUrl").value;

      fetch("/admin/tickets", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ start, end, url })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          const link = document.getElementById("pdfLink");
          link.href = data.url;
          link.style.display = "block";
        }
      });
    }
  </script>
</body>
</html>

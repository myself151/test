<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>管理者画面</title>
</head>
<body>
<h1>管理者画面</h1>

<label>管理者パスワード: <input type="password" id="adminPass"></label>
<button onclick="setPassword()">決定</button>
<br><br>

<label>場内最大人数: <input type="number" id="maxVenue" value="50"></label>
<label>呼び出し人数: <input type="number" id="notifyCount" value="3"></label>
<button onclick="setVenue()">設定</button>
<br><br>

<label>整理券開始番号: <input type="number" id="startNum"></label>
<label>整理券終了番号: <input type="number" id="endNum"></label>
<button onclick="issueTickets()">発行</button>
<br><br>

<button onclick="resetSystem()">リセット</button>
<button onclick="showStats()">集計</button>
<div id="stats"></div>

<script>
let password = null;

function setPassword(){
  password = document.getElementById('adminPass').value;
  alert('管理者パスワード設定完了');
}

function setVenue(){
  fetch('/admin/setVenue',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      maxVenue: document.getElementById('maxVenue').value,
      notifyCount: document.getElementById('notifyCount').value
    })
  }).then(r=>r.json()).then(()=>alert('設定完了'));
}

function issueTickets(){
  fetch('/admin/issue',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      start: document.getElementById('startNum').value,
      end: document.getElementById('endNum').value
    })
  }).then(r=>r.json()).then(res=>{
    alert('整理券発行完了: '+res.file);
  });
}

function resetSystem(){
  fetch('/admin/reset',{method:'POST'}).then(r=>r.json()).then(()=>alert('リセット完了'));
}

function showStats(){
  fetch('/user/current')
    .then(r=>r.json())
    .then(data=>{
      document.getElementById('stats').innerText =
        `現在呼び出し番号: ${data.current}\n通知対象: ${data.notify.join(',')}`;
    });
}
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>管理者 - 設定</title>
</head>
<body>
<h1>管理者 - 設定</h1>

<label>管理者パスワード: <input type="password" id="password"></label>
<button onclick="setPassword()">設定</button>
<br><br>

<label>場内最大人数: <input type="number" id="maxVenue" value="50"></label>
<label>通知数: <input type="number" id="notifyCount" value="3"></label>
<button onclick="setVenue()">設定</button>
<br><br>

<label>整理券開始番号: <input type="number" id="start"></label>
<label>終了番号: <input type="number" id="end"></label>
<button onclick="issue()">整理券発行(PDF)</button>
<br><br>

<button onclick="resetAll()">リセット</button>
<button onclick="aggregate()">集計</button>

<script>
async function setPassword(){
  const pw = document.getElementById('password').value;
  await fetch('/admin/setPassword',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({password:pw})
  });
  alert('パスワード設定完了');
}

async function setVenue(){
  const maxVenue = document.getElementById('maxVenue').value;
  const notifyCount = document.getElementById('notifyCount').value;
  await fetch('/admin/setVenue',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({maxVenue,notifyCount})
  });
  alert('設定完了');
}

async function issue(){
  const start = document.getElementById('start').value;
  const end = document.getElementById('end').value;
  const res = await fetch('/admin/issue',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({start,end})
  });
  const blob = await res.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'tickets.pdf';
  a.click();
}

async function resetAll(){
  await fetch('/admin/reset',{method:'POST'});
  alert('リセット完了');
}

function aggregate(){
  fetch('/user/current').then(r=>r.json()).then(data=>{
    alert(`呼び出し番号: ${data.current}, 通知対象: ${data.notify.join(',')}`);
  });
}
</script>
</body>
</html>

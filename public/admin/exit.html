<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>退場カメラ</title>
<style>
body { font-family: sans-serif; text-align:center; margin:0; padding:0; }
#video { width: 80%; max-width: 600px; margin-top: 20px; }
#status { margin-top: 20px; font-size: 24px; color: green; }
</style>
</head>
<body>
<h1>退場チェックアウト</h1>
<video id="video" autoplay></video>
<div id="status"></div>

<script src="/script.js"></script>
<script>
const video = document.getElementById("video");
const status = document.getElementById("status");

// カメラ起動
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
  .then(stream => { video.srcObject = stream; })
  .catch(err => { status.textContent = "カメラにアクセスできません"; console.error(err); });

// QR読み取り用
const qrScanner = new QrScanner(video, result => {
  fetch("/exit", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ number: result })
  })
  .then(res => res.json())
  .then(data => {
    if(data.ok){
      status.textContent = "お進みください";
      setTimeout(()=>status.textContent="",1000);
    } else {
      status.textContent = data.error || "チェックアウト失敗";
    }
  });
});

qrScanner.start();
</script>
<script type="module" src="https://unpkg.com/qr-scanner@1.4.2/qr-scanner.min.js"></script>
</body>
</html>

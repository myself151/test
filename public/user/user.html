<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>整理券 呼び出し番号</title>
  <style>
    body {
      background: #f0f0f0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    #current-number {
      font-size: 5em;
      font-weight: bold;
      margin: 20px;
    }
    #inside-status {
      font-size: 1.5em;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>現在の呼び出し番号</h1>
  <div id="current-number">-</div>
  <div id="inside-status"></div>

  <script>
    async function updateStatus() {
      try {
        const res = await fetch("/status");
        const data = await res.json();
        document.getElementById("current-number").textContent = data.currentNumber || "-";
        document.getElementById("inside-status").textContent =
          `場内人数: ${data.inside} / 最大 ${data.maxCapacity}`;
      } catch (e) {
        console.error(e);
      }
    }

    setInterval(updateStatus, 3000);
    updateStatus();
  </script>
  <script>
  const callDisplay = document.getElementById("call-number");
  const socket = new WebSocket(`ws://${location.host}`);

  socket.onmessage = (event) => {
    const data = JSON.parse(event.data);
    if (data.type === "callUpdate") {
      callDisplay.textContent = data.number;
    }
  };

  // 初期読み込み時
  fetch("/user/current-call")
    .then(res => res.json())
    .then(data => {
      callDisplay.textContent = data.number;
    });
</script>
<section>
  <h2>USER URL 設定</h2>
  <input type="text" id="userUrlInput" placeholder="https://example.com/user">
  <button id="saveUserUrlBtn" type="button">保存</button>
</section>

<script>
document.getElementById('saveUserUrlBtn').addEventListener('click', async () => {
  const url = document.getElementById('userUrlInput').value;
  if (!url) {
    alert('URLを入力してください');
    return;
  }
  const res = await fetch('/admin/setUserUrl', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userUrl: url })
  });
  if (res.ok) {
    alert('USER URLを保存しました');
  } else {
    alert('保存に失敗しました');
  }
});
</script>

</body>
</html>

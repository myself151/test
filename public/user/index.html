<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>利用者画面</title>
</head>
<body>
<h1>整理券確認</h1>
<label>整理券番号: <input type="number" id="ticketNum"></label>
<button onclick="checkTicket()">確認</button>
<p id="status"></p>

<script>
let myTicket = null;

function checkTicket(){
  myTicket = document.getElementById('ticketNum').value;
  updateStatus();
}

function updateStatus(){
  if(!myTicket) return;
  fetch('/user/current')
    .then(r=>r.json())
    .then(data=>{
      const cur = data.current;
      const notify = data.notify;
      let s = '';
      if(notify.includes(parseInt(myTicket))) s += '呼び出し中\n';
      if(cur==myTicket) s+='今呼ばれています\n';
      document.getElementById('status').innerText = s;
    });
  setTimeout(updateStatus,3000);
}
</script>
</body>
</html>
